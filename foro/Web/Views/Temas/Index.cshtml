@model X.PagedList.IPagedList<foro.Web.DTOs.TemaListDto>
@using X.PagedList.Mvc.Core
@using X.PagedList.Extensions

@{
    ViewData["Title"] = "Listado de Temas";
}

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
      <h1 class="display-5">
         <i class="bi bi-chat-left-text"></i> Foro de Discusión
      </h1>
        <a asp-action="Create" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle"></i> Nuevo Tema
    </a>
            </div>
        </div>
    </div>

    @* Mensajes de éxito o error *@
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle"></i> @TempData["Success"]
     <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @* Filtros de búsqueda *@
    <div class="card shadow-sm mb-4">
        <div class="card-body">
 <form asp-action="Index" method="get">
     <div class="row g-3">
              <div class="col-md-5">
       <label for="searchString" class="form-label">
    <i class="bi bi-search"></i> Buscar por título
   </label>
                 <input type="text" 
       class="form-control" 
       id="searchString" 
        name="searchString" 
       placeholder="Ingrese el título del tema..." 
           value="@ViewBag.SearchString">
        </div>
       <div class="col-md-4">
     <label for="categoriaId" class="form-label">
        <i class="bi bi-folder"></i> Filtrar por categoría
 </label>
<select class="form-select" id="categoriaId" name="categoriaId">
          <option value="">Todas las categorías</option>
     @foreach (var item in ViewBag.Categorias)
        {
     <option value="@item.Value" selected="@(item.Selected)">@item.Text</option>
    }
       </select>
        </div>
       <div class="col-md-3 d-flex align-items-end">
    <button type="submit" class="btn btn-primary w-100 me-2">
       <i class="bi bi-funnel"></i> Filtrar
            </button>
     <a asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-x-circle"></i>
  </a>
  </div>
     </div>
     </form>
        </div>
    </div>

    @* Listado de temas *@
    @if (Model != null && Model.Any())
    {
 <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
            <h5 class="mb-0">
 <i class="bi bi-list-ul"></i> Temas (@Model.TotalItemCount)
         </h5>
          </div>
            <div class="list-group list-group-flush">
    @foreach (var tema in Model)
         {
              <div class="list-group-item list-group-item-action">
             <div class="row align-items-center">
        <div class="col-md-7">
             <div class="d-flex w-100 justify-content-between">
        <h5 class="mb-1">
      @if (tema.Fijado)
     {
    <i class="bi bi-pin-fill text-warning" title="Tema fijado"></i>
       }
   @if (tema.Cerrado)
      {
             <i class="bi bi-lock-fill text-danger" title="Tema cerrado"></i>
         }
    <a asp-action="Details" asp-route-id="@tema.Id" class="text-decoration-none">
           @tema.Titulo
         </a>
           </h5>
          </div>
     <p class="mb-1">
       <span class="badge bg-info">
      <i class="bi bi-folder"></i> @tema.CategoriaNombre
    </span>
            <small class="text-muted">
     por <strong>@tema.UsuarioNombre</strong>
      </small>
        </p>
 </div>
  <div class="col-md-3">
          <small class="text-muted d-block">
      <i class="bi bi-calendar3"></i> @tema.FechaCreacion.ToString("dd/MM/yyyy HH:mm")
           </small>
              <small class="text-muted d-block">
            <i class="bi bi-chat-left-dots"></i> @tema.NumeroMensajes mensajes
            </small>
         <small class="text-muted d-block">
       <i class="bi bi-eye"></i> @tema.Vistas vistas
      </small>
               </div>
     <div class="col-md-2 text-end">
     <div class="btn-group" role="group">
            <a asp-action="Details" asp-route-id="@tema.Id" 
      class="btn btn-sm btn-outline-info" title="Ver detalles">
             <i class="bi bi-eye"></i>
            </a>
          <a asp-action="Edit" asp-route-id="@tema.Id" 
          class="btn btn-sm btn-outline-warning" title="Editar">
   <i class="bi bi-pencil"></i>
   </a>
        <a asp-action="Delete" asp-route-id="@tema.Id" 
        class="btn btn-sm btn-outline-danger" title="Eliminar">
 <i class="bi bi-trash"></i>
        </a>
        </div>
        </div>
             </div>
          </div>
         }
   </div>
        </div>

        @* Paginación *@
        <div class="d-flex justify-content-center mt-4">
            <nav aria-label="Paginación de temas">
                @Html.PagedListPager(Model, page => Url.Action("Index", new { page, searchString = ViewBag.SearchString, categoriaId = ViewBag.CategoriaId }),
          new PagedListRenderOptions
         {
                LiElementClasses = new[] { "page-item" },
    PageClasses = new[] { "page-link" },
        UlElementClasses = new[] { "pagination" },
        DisplayLinkToFirstPage = PagedListDisplayMode.Always,
     DisplayLinkToLastPage = PagedListDisplayMode.Always,
       DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
     DisplayLinkToNextPage = PagedListDisplayMode.Always,
   LinkToFirstPageFormat = "««",
              LinkToPreviousPageFormat = "«",
      LinkToNextPageFormat = "»",
   LinkToLastPageFormat = "»»"
  })
          </nav>
     </div>

    }
    else
    {
        <div class="alert alert-info text-center" role="alert">
      <i class="bi bi-info-circle fs-1 d-block mb-3"></i>
 <h4>No se encontraron temas</h4>
            <p class="mb-3">No hay temas que coincidan con los criterios de búsqueda.</p>
 <a asp-action="Create" class="btn btn-primary">
     <i class="bi bi-plus-circle"></i> Crear el primer tema
      </a>
        </div>
    }
</div>

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
}
